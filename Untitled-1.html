<!-- <!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Fetch Tutorial</title>
</head>
<h1>Welcome</h1>
<body>
	<script>
		let url = "http://localhost:3000/putlast"
		
		let payload = {
			"profile": {
				"displayName": "Thanagorn Pongpluem",
				"userId": "Uf746c996fbcab2ce1e7df9e5bed244f5",
				"pictureUrl": "https://sprofile.line-scdn.net/0hX9PVYMgKBxZ9LxGk5Qd5aQ1_BHxeXl4EBR5Bckl8DXVHTUMSWExLdEspCSJBFklEUE8ddU8vXCNxPHBwY3n7InofWidBHkBEUkxA9A",
				"language": "th"
			},
			"_id": "64d346b50015bec4a1db6214",
			"type": "beacon",
			"timestamp": "2023-08-09T07:56:36.276Z",
			"__v": 0
		}
		
		let options = {
			method: "PUT",
			headers: {
				"Content-Type": "application/json"
			},
			body: JSON.stringify(payload)
		}
		
		fetch(url, options)
		.then(response => {
			if (response.ok) {
				console.log("Data sent successfully");
			} else {
				console.error("Error sending data");
			}
		})
		.catch(error => {
			console.error("An error occurred:", error);
		});
	</script>
</body>
</html> -->


<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fetch Data from Server</title>
</head>
<body>
  <div id="result"></div>

  <script>
    async function fetchData() {
      try {
        const response = await fetch('http://localhost:3000/putlast', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          const data = await response.json();
          updateUIWithData(data);
        } else {
          document.getElementById('result').innerHTML = 'Error fetching data';
        }
      } catch (error) {
        console.error('An error occurred:', error);
        document.getElementById('result').innerHTML = 'An error occurred';
      }
    }

    function updateUIWithData(data) {
      const resultElement = document.getElementById('result');
      resultElement.innerHTML = JSON.stringify(data, null, 2);
    }

    // เรียกใช้งาน fetchData เมื่อหน้าเว็บโหลดเสร็จ
    window.addEventListener('load', () => {
      fetchData();
    });
  </script>
</body>
</html> -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fetch and Update Data from Server</title>
</head>
<body>
  <div id="result"></div>

  <script>
    async function fetchDataAndRender() {
      try {
        const response = await fetch('http://localhost:3000/putlast', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          const data = await response.json();
          updateUIWithData(data);
        } else {
          document.getElementById('result').innerHTML = 'Error fetching data';
        }
      } catch (error) {
        console.error('An error occurred:', error);
        document.getElementById('result').innerHTML = 'An error occurred';
      }
    }

    function updateUIWithData(data) {
      const resultElement = document.getElementById('result');
      resultElement.innerHTML = JSON.stringify(data, null, 2);
    }

    // เรียกใช้งาน fetchDataAndRender เพื่อโหลดข้อมูลและแสดงผลครั้งแรก
    window.addEventListener('load', () => {
      fetchDataAndRender();
    });

    // สร้าง WebSocket เพื่อติดตามการอัพเดตข้อมูลจากเซิร์ฟเวอร์
    const socket = new WebSocket('ws://localhost:3000'); // เปลี่ยน URL ตามต้องการ

    // ตรวจจับเหตุการณ์เมื่อมีข้อมูลใหม่ถูกส่งผ่าน WebSocket
    socket.addEventListener('message', (event) => {
      const newData = JSON.parse(event.data);
      updateUIWithData(newData);
    });
  </script>
</body>
</html>
